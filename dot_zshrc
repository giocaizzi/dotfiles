# ============================================================================
# ZSH CONFIGURATION (Minimal)
# ============================================================================
# Shell-specific features only. Universal config is in ~/.profile

# Source shared configuration
if [ -z "$PROFILE_SOURCED" ]; then
	export PROFILE_SOURCED=1
	[ -f "$HOME/.profile" ] && . "$HOME/.profile"
fi

# ----------------------------------------------------------------------------
# PYENV (Lazy Loading)
# ----------------------------------------------------------------------------

if command -v pyenv &> /dev/null; then
	function pyenv() {
		unset -f pyenv
		eval "$(command pyenv init - zsh)"
		pyenv "$@"
	}
fi

# ----------------------------------------------------------------------------
# OH MY ZSH
# ----------------------------------------------------------------------------

export ZSH="$HOME/.oh-my-zsh"
export ZSH_DISABLE_COMPFIX=true
export ZSH_COMPDUMP="$HOME/.zcompdump"

# Plugins
plugins=(git docker gh)

# Disable auto-update (update manually with: omz update)
zstyle ':omz:update' mode disabled

source "$ZSH/oh-my-zsh.sh"

# ----------------------------------------------------------------------------
# HISTORY
# ----------------------------------------------------------------------------

HISTSIZE=50000
SAVEHIST=50000
HISTFILE=~/.zsh_history

setopt EXTENDED_HISTORY HIST_IGNORE_ALL_DUPS HIST_FIND_NO_DUPS
setopt HIST_IGNORE_SPACE HIST_REDUCE_BLANKS SHARE_HISTORY HIST_VERIFY

# ----------------------------------------------------------------------------
# ZSH OPTIONS
# ----------------------------------------------------------------------------

# Navigation
setopt AUTO_CD AUTO_PUSHD PUSHD_IGNORE_DUPS PUSHD_SILENT

# Globbing
setopt EXTENDED_GLOB GLOB_DOTS NO_CASE_GLOB NUMERIC_GLOB_SORT

# Misc
setopt CORRECT INTERACTIVE_COMMENTS NOTIFY

# ----------------------------------------------------------------------------
# FZF & AUTOSUGGESTIONS
# ----------------------------------------------------------------------------

# FZF key bindings (options set in ~/.profile)
if [[ -n "$HOMEBREW_PREFIX" ]]; then
	[[ -f "$HOMEBREW_PREFIX/opt/fzf/shell/completion.zsh" ]] && source "$HOMEBREW_PREFIX/opt/fzf/shell/completion.zsh"
	[[ -f "$HOMEBREW_PREFIX/opt/fzf/shell/key-bindings.zsh" ]] && source "$HOMEBREW_PREFIX/opt/fzf/shell/key-bindings.zsh"
elif [[ -f ~/.fzf.zsh ]]; then
	source ~/.fzf.zsh
fi

# Autosuggestions
if [[ -n "$HOMEBREW_PREFIX" && -f "$HOMEBREW_PREFIX/share/zsh-autosuggestions/zsh-autosuggestions.zsh" ]]; then
	source "$HOMEBREW_PREFIX/share/zsh-autosuggestions/zsh-autosuggestions.zsh"
	ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=8'
	ZSH_AUTOSUGGEST_STRATEGY=(history completion)
fi

# ----------------------------------------------------------------------------
# End of .zshrc
# ----------------------------------------------------------------------------
